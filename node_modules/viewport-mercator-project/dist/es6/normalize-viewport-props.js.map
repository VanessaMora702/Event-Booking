{"version":3,"sources":["../../src/normalize-viewport-props.js"],"names":["WebMercatorViewport","mod","MAX_LATITUDE","MIN_LATITUDE","normalizeViewportProps","width","height","longitude","latitude","zoom","pitch","bearing","flatViewport","topY","project","bottomY","shiftY","Math","log2","unproject"],"mappings":"AAAA,MAAOA,oBAAP,KAAgC,yBAAhC,CACA,OAAQC,GAAR,KAAmB,cAAnB,CAGA,KAAMC,cAAe,QAArB,CACMC,aAAe,CAAC,QADtB,CAKA,cAAe,SAASC,uBAAT,CAAgC,CAC7CC,KAD6C,CAE7CC,MAF6C,CAG7CC,SAH6C,CAI7CC,QAJ6C,CAK7CC,IAL6C,CAM7CC,MAAQ,CANqC,CAO7CC,QAAU,CAPmC,CAAhC,CAQZ,EAEe,CAAC,GAAb,YAAgC,GAAZ,UAFvB,IAGCJ,UAAYN,IAAIM,UAAY,GAAhB,CAAqB,GAArB,EAA4B,GAHzC,GAKa,CAAC,GAAX,UAA4B,GAAV,QALrB,IAMCI,QAAUV,IAAIU,QAAU,GAAd,CAAmB,GAAnB,EAA0B,GANrC,EAUD,GAAIC,cAAe,GAAIZ,oBAAJ,CAAwB,CAACK,KAAD,CAAQC,MAAR,CAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,IAArC,CAAxB,CAAnB,CACII,KAAOD,aAAaE,OAAb,CAAqB,CAACP,SAAD,CAAYL,YAAZ,CAArB,EAAgD,CAAhD,CADX,CAEIa,QAAUH,aAAaE,OAAb,CAAqB,CAACP,SAAD,CAAYJ,YAAZ,CAArB,EAAgD,CAAhD,CAFd,CAGIa,OAAS,CAHb,CA0BA,MArBID,SAAUF,IAAV,CAAiBP,MAqBrB,GAlBEG,MAAQQ,KAAKC,IAAL,CAAUZ,QAAUS,QAAUF,IAApB,CAAV,CAkBV,CAfED,aAAe,GAAIZ,oBAAJ,CAAwB,CAACK,KAAD,CAAQC,MAAR,CAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,IAArC,CAAxB,CAejB,CAdEI,KAAOD,aAAaE,OAAb,CAAqB,CAACP,SAAD,CAAYL,YAAZ,CAArB,EAAgD,CAAhD,CAcT,CAbEa,QAAUH,aAAaE,OAAb,CAAqB,CAACP,SAAD,CAAYJ,YAAZ,CAArB,EAAgD,CAAhD,CAaZ,EAXW,CAAP,KAWJ,CATEa,OAASH,IASX,CARWE,QAAUT,MAQrB,GANEU,OAASD,QAAUT,MAMrB,EAJIU,MAIJ,GAHER,SAAWI,aAAaO,SAAb,CAAuB,CAACd,MAAQ,CAAT,CAAYC,OAAS,CAAT,CAAaU,MAAzB,CAAvB,EAAyD,CAAzD,CAGb,EAAO,CAACX,KAAD,CAAQC,MAAR,CAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,IAArC,CAA2CC,KAA3C,CAAkDC,OAAlD,CACR","sourcesContent":["import WebMercatorViewport from './web-mercator-viewport';\nimport {mod}  from './math-utils';\n\n// defined by mapbox-gl\nconst MAX_LATITUDE = 85.05113;\nconst MIN_LATITUDE = -85.05113;\n\n// Apply mathematical constraints to viewport props\n/* eslint-disable complexity */\nexport default function normalizeViewportProps({\n  width,\n  height,\n  longitude,\n  latitude,\n  zoom,\n  pitch = 0,\n  bearing = 0\n}) {\n  // Normalize degrees\n  if (longitude < -180 || longitude > 180) {\n    longitude = mod(longitude + 180, 360) - 180;\n  }\n  if (bearing < -180 || bearing > 180) {\n    bearing = mod(bearing + 180, 360) - 180;\n  }\n\n  // Constrain zoom and shift center at low zoom levels\n  let flatViewport = new WebMercatorViewport({width, height, longitude, latitude, zoom});\n  let topY = flatViewport.project([longitude, MAX_LATITUDE])[1];\n  let bottomY = flatViewport.project([longitude, MIN_LATITUDE])[1];\n  let shiftY = 0;\n\n  if (bottomY - topY < height) {\n    // Map height must not be smaller than viewport height\n    // Zoom out map to fit map height into viewport\n    zoom += Math.log2(height / (bottomY - topY));\n\n    // Calculate top and bottom using new zoom\n    flatViewport = new WebMercatorViewport({width, height, longitude, latitude, zoom});\n    topY = flatViewport.project([longitude, MAX_LATITUDE])[1];\n    bottomY = flatViewport.project([longitude, MIN_LATITUDE])[1];\n  }\n  if (topY > 0) {\n    // Compensate for white gap on top\n    shiftY = topY;\n  } else if (bottomY < height) {\n    // Compensate for white gap on bottom\n    shiftY = bottomY - height;\n  }\n  if (shiftY) {\n    latitude = flatViewport.unproject([width / 2, height / 2 + shiftY])[1];\n  }\n\n  return {width, height, longitude, latitude, zoom, pitch, bearing};\n}\n"],"file":"normalize-viewport-props.js"}