import cloud from'd3-cloud';import{event as currentEvent}from'd3-selection';import uniqBy from'lodash/uniqBy';import isNull from'lodash/isNull';import maxBy from'lodash/maxBy';import minBy from'lodash/minBy';import{D3,MIN_HEIGHT,MIN_WIDTH,DEFAULT_COLORS}from'./defaultValues';export default(function(){var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h={},i={},j=function(b,c){var d=i,f=d.container,g=f.parentNode,h=g.offsetHeight,j=g.offsetWidth;a=b||h,e=c||j,('number'!=typeof a||a<MIN_HEIGHT)&&(console.warn('Invalid/small height provided, falling back to minimum value of '+MIN_HEIGHT),a=MIN_HEIGHT),('number'!=typeof e||e<MIN_WIDTH)&&(console.warn('Invalid/small width provided, falling back to minimum value of '+MIN_HEIGHT),e=MIN_HEIGHT)},k=function(a){var b={linear:D3.scaleLinear,log:D3.scaleLog,sqrt:D3.scaleSqrt,fontSize:null};return b[a]},l=function(a){var b=h,c=b.words,d=b.fontScale,e=d.minFont,f=d.maxFont,g={MAX:maxBy(c,'total'),MIN:minBy(c,'total'),FONT_MAX:f,FONT_MIN:e},i=a===g.MIN.total?g.FONT_MIN:a/g.MAX.total*(g.FONT_MAX-g.FONT_MIN)+g.FONT_MIN;return i},m=function(a){return a[Math.floor(Math.random()*a.length)]},n=function(a){var b=h,c=b.enableTooltip,d=b.wordKey,e=b.wordCountKey,f=b.tooltip,g=f?f(a):a[d]+' ('+a[e]+')';c&&i.tooltipState({tooltipContent:g,enableTooltip:!0,tooltipX:currentEvent.pageX,tooltipY:currentEvent.pageY-28})},o=function(){h.enableTooltip&&i.tooltipState({enableTooltip:!1})},p=function(a,b){var c=h,d=c.colorScale,e=c.colors;return d?p(a,b):m(e||DEFAULT_COLORS)},q=function(a){var b='translate('+a.x+', '+a.y+')',c='number'==typeof a.rotate?'rotate('+a.rotate+')':'';return b+c},r=function(a){var b=h,c=b.fontFamily,e=b.transitionDuration,g=b.onWordClick,i=b.wordKey;f=d.selectAll('text').data(a),f.enter().append('text').on('click',g).on('mouseover',n).on('mouseout',o).attrs({cursor:g?'pointer':'default',fill:p,"font-family":c,"text-anchor":'middle',transform:'translate(0, 0) rotate(0)'}).transition().duration(e).attrs({"font-size":function(a){return a.size+'px'},transform:q}).text(function(a){return a[i]}),f.transition().duration(e).attrs({fill:p,"font-family":c,"font-size":function(a){return a.size+'px'},transform:q}).text(function(a){return a[i]}),f.exit().transition().duration(e).attr('fill-opacity',0).remove()},s=function(f,n){h=f,i=n;var o=h,p=o.fontFamily,q=o.height,s=o.maxAngle,t=o.maxWords,u=o.minAngle,v=o.orientations,w=o.scale,x=o.spiral,y=o.width,z=o.wordCountKey,A=o.words,B=o.wordKey;j(q,y),c.attrs({height:a,width:e}).style('background','white'),d.attr('transform','translate('+e/2+', '+a/2+')scale(1.0020877122879028,1.0020877122879028)');var C=k(w),D=A.slice(0,t);if(isNull(C)?g=l:(g=1<uniqBy(D,z).length?C().range([10,100]):C().range([100,100]),D.length&&g.domain([D3.min(D,function(a){return a[z]}),D3.max(D,function(a){return a[z]})])),'number'==typeof v&&0<v){var G=[];if(1===v)G=[u];else{G=[u,s];for(var E=(s-u)/(v-1),F=u+E;F<s;)G.push(F),F+=E}b.rotate(function(){return m(G)})}b.size([e,a]).words(D).padding(1).text(function(a){return a[B]}).font(p).fontSize(function(a){return g(a[z])}).spiral(x).on('end',function(a){return r(a)}).start(),g=null},t=function(a,e){h=a,i=e;var f=h,g=f.height,k=f.width,l=i,m=l.chart;D3.select(m).selectAll('*').remove(),j(g,k),c=D3.select(m).append('svg'),d=c.append('g'),b=cloud(),s(h,i)},u=function(a){D3.select(a).selectAll('*').remove(),b=null,c.remove(),d.remove(),f.remove(),g=[]};return{create:t,update:s,destroy:u}})();