var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h['return']&&h['return']()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_this=this;import{event as currentEvent}from'd3-selection';import{D3,DEFAULT_HEIGHT,DEFAULT_WIDTH}from'./defaultValues';export default(function(){var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=[];_this.props={},_this.config={};var n={top:20,right:10,bottom:20,left:10},o=function(c,a){return a-c},p=function(a){return[D3.quantile(a,.25),D3.quantile(a,.5),D3.quantile(a,.75)]},q=function(a){var b=_this.props,c=b.data,d=b.colors,e=b.keyName,f=D3.scaleOrdinal(D3.schemeCategory10).domain(Object.keys(c)),g=d.find(function(b){return b[e]===a});return g?g.color:f(a)},r=function(){var c=_this.props.data;i=D3.scaleBand().domain(Object.keys(c)).range([0,a-n.left-n.right]);var d=D3.max(Object.keys(c).map(function(a){return D3.max(c[a])}));j=D3.scaleLinear().domain([0,d]).range([b-n.top-n.bottom,0]).nice()},s=function(c,i,j,m){a=c,b=i,k=j,l=m,'number'!=typeof b&&(console.warn('Invalid height provided.'),b=DEFAULT_HEIGHT),'number'!=typeof a&&(console.warn('Invalid width provided.'),a=DEFAULT_WIDTH),'number'!=typeof k&&(console.warn('Invalid height provided.'),b=DEFAULT_HEIGHT),'number'!=typeof l&&(console.warn('Invalid width provided.'),a=DEFAULT_WIDTH);var o=_this.props.data,p=a-n.left-n.right;d=p/Object.keys(o).length,e=d*k,f=d*l,g=(d-e)/2,h=(d-f)/2,r()},t=function(){var a=_this.props.data;Object.keys(a).forEach(function(b){var c=a[b];a[b]=c.sort(o)}),Object.entries(a).forEach(function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1],e={},f=D3.min(d),h=D3.max(d);e.key=c,e.counts=d,e.quartile=p(d),e.whiskers=[f,h],e.color=q(c),e.plane={x:i(c)+g,height:j(e.quartile[2])-j(e.quartile[0])},m.push(e)})},u=[{x1:function x1(a){return i(a.key)+h},y1:function y1(a){return j(a.whiskers[0])},x2:function x2(a){return i(a.key)+f+h},y2:function y2(a){return j(a.whiskers[0])}},{x1:function x1(a){return i(a.key)+g},y1:function y1(a){return j(a.quartile[1])},x2:function x2(a){return i(a.key)+e+g},y2:function y2(a){return j(a.quartile[1])}},{x1:function x1(a){return i(a.key)+h},y1:function y1(a){return j(a.whiskers[1])},x2:function x2(a){return i(a.key)+f+h},y2:function y2(a){return j(a.whiskers[1])}}],v=function(a,b,c){var d=D3.select(c[b]).select('.background-bar');d.attr('fill-opacity','0.4'),_this.props.onHover(a)},w=function(a){_this.config.tooltipState({tooltipContent:a.key,enableTooltip:!0,tooltipX:currentEvent.pageX,tooltipY:currentEvent.pageY})},x=function(a,b,c){var d=D3.select(c[b]).select('.background-bar');d.attr('fill-opacity','0'),_this.config.tooltipState({enableTooltip:!1})},y=function(a){_this.props.onClick(a)},z=function(){var f=c.append('g').attr('transform','translate(25, 0)'),h=c.append('g').attr('transform','translate(25, '+(b-n.top-n.bottom)+')'),k=c.append('g').attr('transform','translate(25, 0)'),l=k.selectAll('.column').data(m).enter().append('g').on('click',y).on('mousemove',w).on('mouseover',v).on('mouseout',x);l.append('rect').attr('width',d).attr('height',b-n.bottom-n.top).attr('x',function(a){return i(a.key)}).attr('class','background-bar').attr('fill','#d8d8d8').attr('fill-opacity','0'),l.append('line').attr('x1',function(a){return i(a.key)+e/2+g}).attr('y1',function(a){var b=a.whiskers[0];return j(b)}).attr('x2',function(a){return i(a.key)+e/2+g}).attr('y2',function(a){var b=a.whiskers[1];return j(b)}).attr('cursor','pointer').attr('stroke','#000').attr('stroke-width',1).attr('fill','none'),l.append('rect').attr('width',e).attr('height',function(a){return a.plane.height}).attr('cursor','pointer').attr('x',function(a){return a.plane.x}).attr('y',function(a){return j(a.quartile[0])}).attr('fill',function(a){return a.color}).attr('stroke','#000').attr('stroke-width',1),u.forEach(function(a){l.append('line').attr('x1',a.x1).attr('y1',a.y1).attr('x2',a.x2).attr('y2',a.y2).attr('cursor','pointer').attr('stroke','#000').attr('stroke-width',1).attr('fill','none')});var o=D3.axisLeft(j);o.ticks(5),f.append('g').call(o),f.select('.domain').remove(),f.selectAll('.tick line').attr('x2',a).attr('stroke','#efefef').attr('stroke-width',1),f.selectAll('.tick text').attr('font-size',12);var p=D3.axisBottom(i);p.tickValues(Object.keys(_this.props.data).filter(function(a,b,c){var d=Math.ceil(c.length/5);return 0==b%d})),h.append('g').call(p),h.select('.domain').remove(),h.selectAll('.tick line').remove(),h.selectAll('.tick text').attr('font-size',12)},A=function(d,e){_this.props=d,_this.config=e;var f=_this.props,g=f.width,h=f.height,i=f.barWidth,j=f.whiskerWidth;s(g,h,i,j),c=D3.select(_this.config.domElement).append('svg').attr('width',a+n.left+n.right).attr('height',b+n.top+n.bottom).append('g').attr('width',a+n.left+n.right).attr('height',b+n.top+n.bottom).attr('transform','translate('+n.left+','+n.top+')'),t(),z()},B=function(d,e){_this.props=d,_this.config=e;var f=_this.props,g=f.width,h=f.height,i=f.barWidth,j=f.whiskerWidth;s(g,h,i,j),c=D3.select(_this.config.domElement).append('svg').attr('width',a+n.left+n.right).attr('height',b+n.top+n.bottom).append('g').attr('transform','translate('+n.left+','+n.top+')'),t(),z()},C=function(a){D3.selectAll(a).selectAll('*').remove(),c.remove()};return{create:A,update:B,destroy:C}})();